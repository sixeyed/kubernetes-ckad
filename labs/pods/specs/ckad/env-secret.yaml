apiVersion: v1
kind: Secret
metadata:
  name: app-secrets
  labels:
    kubernetes.courselabs.co: pods
type: Opaque
stringData:
  database-username: "admin"
  database-password: "P@ssw0rd123"
  api-key: "sk-1234567890abcdef"
  tls.crt: |
    -----BEGIN CERTIFICATE-----
    MIICxjCCAa4CCQD...
    -----END CERTIFICATE-----
  tls.key: |
    -----BEGIN PRIVATE KEY-----
    MIIEvQIBADANBgk...
    -----END PRIVATE KEY-----
---
# Using individual secrets as env vars
apiVersion: v1
kind: Pod
metadata:
  name: env-secret-individual
  labels:
    app: secret-demo
    kubernetes.courselabs.co: pods
spec:
  containers:
  - name: app
    image: busybox:latest
    command:
    - sh
    - -c
    - |
      echo "=== Environment Variables from Secret ==="
      echo "Database Username: $DB_USER"
      echo "Database Password: [REDACTED]"
      echo "API Key: ${API_KEY:0:10}..."
      sleep 3600
    env:
    - name: DB_USER
      valueFrom:
        secretKeyRef:
          name: app-secrets
          key: database-username
    - name: DB_PASSWORD
      valueFrom:
        secretKeyRef:
          name: app-secrets
          key: database-password
    - name: API_KEY
      valueFrom:
        secretKeyRef:
          name: app-secrets
          key: api-key
---
# Using envFrom to load all Secret keys
apiVersion: v1
kind: Pod
metadata:
  name: env-secret-all
  labels:
    app: secret-demo
    kubernetes.courselabs.co: pods
spec:
  containers:
  - name: app
    image: busybox:latest
    command:
    - sh
    - -c
    - |
      echo "=== All Secret Keys as Environment Variables ==="
      env | grep -E "database-" | sed 's/=.*/=[REDACTED]/'
      sleep 3600
    envFrom:
    - secretRef:
        name: app-secrets
---
# Using Secret as volume mount (e.g., for TLS certificates)
apiVersion: v1
kind: Pod
metadata:
  name: env-secret-volume
  labels:
    app: secret-demo
    kubernetes.courselabs.co: pods
spec:
  containers:
  - name: app
    image: busybox:latest
    command:
    - sh
    - -c
    - |
      echo "=== Secret Mounted as Files ==="
      ls -la /secrets/
      echo ""
      echo "Certificate present: $(test -f /secrets/tls.crt && echo 'YES' || echo 'NO')"
      echo "Private key present: $(test -f /secrets/tls.key && echo 'YES' || echo 'NO')"
      sleep 3600
    volumeMounts:
    - name: secret-volume
      mountPath: /secrets
      readOnly: true
  volumes:
  - name: secret-volume
    secret:
      secretName: app-secrets
      items:
      - key: tls.crt
        path: tls.crt
      - key: tls.key
        path: tls.key
        mode: 0400  # Read-only for owner
